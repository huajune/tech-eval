# 文档评审意见回应

**评审日期：** 2025-10-28
**评审来源：** GPT-5 Review

---

## 一、评审意见评估结果

### ✅ 采纳（不增加复杂度且重要）

#### 1. 核心统一与取舍
| 意见 | 评估 | 行动 |
|-----|------|------|
| 题型统一：每次2道简答题固定 | ✅ 采纳 | 更新所有文档，统一为架构1题+数据库1题 |
| 难度分布固定：11易+7中+2难 | ✅ 采纳 | 已在文档中，确保执行一致 |
| 职级映射仅输出P5-P9 | ✅ 采纳 | 移除Google L级，放入V2 |
| PDF导出、百分位等放入V2 | ✅ 采纳 | 明确标注MVP范围 |

#### 2. 安全与反作弊（MVP关键）
| 意见 | 评估 | 行动 |
|-----|------|------|
| 严禁泄露答案：服务端比对 | ✅ 采纳 | API只返回题目内容，不返回correct_answer |
| 反作弊规则统一：3次警告5次终止 | ✅ 采纳 | 明确规则，空闲提示不计入作弊次数 |
| 计时以服务端为准：心跳机制 | ✅ 采纳 | 添加30秒心跳，服务端强制到时终止 |
| API节流 | ⚠️ 简化采纳 | Next.js middleware级别限流，不做复杂IP+会话 |

#### 3. 数据库与Schema调整
| 意见 | 评估 | 行动 |
|-----|------|------|
| `cheating_logs.timestamp` → `created_at` | ✅ 采纳 | 统一命名规范 |
| 精简可选字段：percentile/strengths等 | ✅ 采纳 | MVP动态计算，不持久化 |
| Supabase对齐：首登Upsert | ✅ 采纳 | 简化用户同步逻辑 |
| JSONB筛选用`@>`谓词 | ✅ 采纳 | 技术实现细节，使用原生SQL |

#### 4. 题库与出题算法
| 意见 | 评估 | 行动 |
|-----|------|------|
| 题库质量优先于数量：60题可接受 | ✅ 采纳 | 保证每维度2-3倍题量 |
| 元数据完整性校验 | ✅ 采纳 | 添加种子数据校验脚本 |
| 生成器兜底 | ❌ 暂不采纳 | MVP题量不足直接报错，V2再做智能回填 |

#### 5. 评分与人工评阅
| 意见 | 评估 | 行动 |
|-----|------|------|
| 多选题全对得分（不设部分对） | ✅ 采纳 | 简化评分逻辑 |
| 简答题评分rubric公开 | ✅ 采纳 | 在题目中明确评分标准 |
| 结果出具：选择题先出，简答题待评阅 | ✅ 采纳 | 已在设计中 |

#### 6. 前端体验与时序
| 意见 | 评估 | 行动 |
|-----|------|------|
| 断线恢复 | ✅ 已有 | 确认执行 |
| 自动保存+localStorage回退 | ⚠️ 简化采纳 | MVP仅做30秒定时保存，V2再加localStorage |
| 5次作弊直接提交 | ✅ 采纳 | 已在设计中 |

#### 7. 权限与最小管理
| 意见 | 评估 | 行动 |
|-----|------|------|
| 管理入口最小化 | ✅ 已有 | 确认执行 |
| 评阅端不含correct_answer | ✅ 采纳 | 创建脱敏视图 |

#### 8. 实施与验证
| 意见 | 评估 | 行动 |
|-----|------|------|
| 接口契约明确 | ✅ 采纳 | 补充API接口文档 |
| 手工验证清单 | ✅ 采纳 | 添加到测试阶段 |

#### 9. 产品策略
| 意见 | 评估 | 行动 |
|-----|------|------|
| 简答题字数限制150字 | ✅ 采纳 | 前端+后端双重校验 |
| 题库优先覆盖通用工程题 | ✅ 采纳 | 避免过细的库细节题 |

---

## 二、不采纳或延期的意见

| 意见 | 理由 | 后续计划 |
|-----|------|---------|
| 生成器智能回填 | 增加算法复杂度，MVP题量充足情况下不需要 | V2动态题库时考虑 |
| localStorage回退 | 增加状态同步复杂度，MVP网络异常概率低 | V2优化用户体验 |
| IP+会话级API节流 | 需要Redis等额外基础设施 | V2高并发优化 |

---

## 三、需要修正的文档错误

### 1. 链接错误修复
- ❌ 错误链接：阿里技术职级体系指向知乎
- ✅ 修正方案：移除失效链接，改为文字描述或可靠来源

### 2. 统一性问题
- 题型分布在不同文档中不一致 → 统一为18选择题+2简答题
- 职级映射同时提到P级和L级 → MVP仅保留P级

---

## 四、核心改进要点总结

### 安全性强化（最高优先级）
```typescript
// ❌ 错误：客户端接收答案
const questions = await fetch('/api/exam/questions');
// response: { id, content, options, correct_answer } // 泄露答案！

// ✅ 正确：服务端比对
const questions = await fetch('/api/exam/questions');
// response: { id, content, options } // 只返回题目
// 提交答案后服务端比对并返回 is_correct
```

### 反作弊规则明确
```
页面失焦行为分类：
1. 切换Tab/窗口 → 累计次数，3次警告，5次强制提交
2. 鼠标/键盘空闲 → 2分钟提示"请继续答题"，不计入作弊次数
3. 复制粘贴 → 记录日志，MVP不阻止
```

### 计时同步机制
```typescript
// 服务端为准
1. 创建会话时记录 start_time + duration_minutes
2. 客户端每30秒心跳上报，同步 remaining_seconds
3. 服务端计算实际经过时间，到时强制终止会话
4. 客户端倒计时仅用于显示，不作为判定依据
```

### 评分规则简化
```
选择题：
- 单选：答对得分，答错0分
- 多选：全对得分，漏选/错选均0分（不设部分对）

简答题：
- 满分5分，公开评分rubric
- 示例：提到缓存1分 + 分库分表1分 + 消息队列1分 + 幂等性1分 + 整体合理性1分
```

---

## 五、后续行动计划

### 立即执行（今天）
- [x] 修复PRD中的链接错误
- [x] 更新数据库Schema：字段更名、精简可选字段
- [x] 创建API接口契约文档
- [x] 添加手工验证清单

### Phase 1执行（数据库阶段）
- [ ] 实现题库元数据校验脚本
- [ ] 确保60-80题高质量题库
- [ ] 每道题添加评分rubric

### Phase 3执行（答题引擎阶段）
- [ ] 实现30秒心跳机制
- [ ] 实现服务端强制到时
- [ ] API返回题目时过滤敏感字段

### Phase 6执行（测试阶段）
- [ ] 执行手工验证清单
- [ ] 网络抓包验证无答案泄露

---

**评估结论：**
- ✅ 采纳改进：15项（核心功能与安全）
- ⚠️ 简化采纳：3项（降低实现复杂度）
- ❌ 暂不采纳：3项（延期到V2）

**预计增加工作量：** +1天（主要是心跳机制和API安全加固）
**风险降低收益：** 显著提升安全性和评估准确性

---

**文档维护者：** Product & Tech Team
**最后更新：** 2025-10-28
