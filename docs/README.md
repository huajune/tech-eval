# 技术能力评估系统 - 项目文档

**项目名称：** TechEval - 工程师技术能力评估平台
**当前版本：** MVP v1.0
**最后更新：** 2025-10-28

---

## 📚 文档导航

### 核心文档（必读）

1. **[PRD-技术能力评估系统.md](./PRD-技术能力评估系统.md)**
   - 产品需求文档
   - 业务背景与目标
   - 4大考察维度定义
   - 职级映射标准（P5-P9）
   - 功能模块设计（5个核心模块）
   - 题库设计（80题静态题库）
   - 防作弊机制
   - 自动评分算法

2. **[MVP任务拆解.md](./MVP任务拆解.md)**
   - 2-3周开发排期
   - 6个开发阶段详细任务
   - 每个任务的工作量、优先级、验收标准
   - 技术栈清单
   - 项目文件结构
   - 风险与应对策略

3. **[数据库Schema设计.md](./数据库Schema设计.md)**
   - ER关系图
   - 7张核心表设计（users, exams, questions, exam_sessions, answers, cheating_logs, exam_results）
   - 索引与约束
   - JSONB字段设计
   - Drizzle ORM查询示例
   - 性能优化建议
   - 安全性（Row Level Security）

4. **[API接口契约与安全规范.md](./API接口契约与安全规范.md)** ⭐ 重要
   - 核心安全原则（答案保护、服务端评分、会话验证）
   - 10个API接口详细定义
   - 数据脱敏规范
   - 错误处理规范
   - 性能与安全要求
   - **手工验证清单（MVP测试必须）**

### 参考文档

5. **[评审意见回应.md](./评审意见回应.md)**
   - GPT-5评审意见评估结果
   - 采纳的改进（15项）
   - 不采纳或延期的理由
   - 核心改进要点总结
   - 后续行动计划

---

## 🎯 快速开始

### 第一步：理解产品
阅读顺序：
1. **PRD** → 理解业务需求和产品设计
2. **MVP任务拆解** → 了解开发范围和排期
3. **数据库Schema** → 理解数据模型

### 第二步：开始开发
1. 查看 **MVP任务拆解.md** 中的 Phase 1
2. 创建数据库Schema（`db/schema.ts`）
3. 按照任务清单逐步实现

### 第三步：安全实施
- ⚠️ 开发API前必读 **API接口契约与安全规范.md**
- ✅ 确保严格遵守答案保护原则
- ✅ 实现会话验证和服务端评分

### 第四步：测试验证
- 执行 **API接口契约与安全规范.md** 中的"手工验证清单"
- 重点验证安全性（答案泄露检查）
- 验证防作弊监控

---

## 📐 技术架构概览

### 技术栈
- **前端：** Next.js 15 + React 19 + TypeScript
- **后端：** Next.js API Routes + Server Actions
- **数据库：** PostgreSQL (Supabase) + Drizzle ORM
- **认证：** Supabase Auth (Cookie-based sessions)
- **UI：** Tailwind CSS + shadcn/ui
- **图表：** Recharts（能力雷达图）

### 核心功能模块
```
┌─────────────────────────────────────────┐
│         考试配置 (Exam Setup)            │
│  选择角色/语言/框架 → 创建会话           │
└─────────────┬───────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│       答题引擎 (Exam Engine)             │
│  - 倒计时器（10分钟）                    │
│  - 防作弊监控（3次警告5次终止）          │
│  - 自动保存（30秒）                      │
│  - 心跳同步（服务端计时）                │
└─────────────┬───────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│      评分系统 (Scoring Engine)           │
│  - 选择题自动评分                        │
│  - 简答题人工评阅                        │
│  - 4维能力计算 + 职级映射                │
└─────────────┬───────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│      结果报告 (Result Report)            │
│  - 能力雷达图                            │
│  - 职级评估（P5-P9）                     │
│  - 答案解析                              │
└─────────────────────────────────────────┘
```

---

## 🔒 核心安全原则（必须遵守）

### 1. 答案保护
❌ **禁止：** 客户端接收 `correct_answer`、`weight`、`reference_answer`
✅ **正确：** API只返回题目内容和选项，答案比对在服务端

### 2. 服务端评分
❌ **禁止：** 前端计算分数
✅ **正确：** 所有评分逻辑在服务端执行

### 3. 会话验证
❌ **禁止：** 信任客户端传递的剩余时间
✅ **正确：** 服务端基于 `start_time` 计算实际经过时间

### 4. 反作弊规则
- 切换Tab：3次警告，5次强制提交
- 空闲2分钟：提示但不计入作弊次数
- 复制粘贴：记录日志（MVP不阻止）

---

## 📊 数据模型核心表

| 表名 | 作用 | 关键字段 |
|-----|------|---------|
| `users` | 用户信息 | auth_user_id, role |
| `exams` | 考试模板 | role, language, framework |
| `questions` | 题库 | type, correct_answer, ability_dimension |
| `exam_sessions` | 考试会话 | status, selected_questions, cheating_warnings |
| `answers` | 答案记录 | user_answer, is_correct, manual_score |
| `cheating_logs` | 作弊日志 | event_type, duration_seconds |
| `exam_results` | 考试结果 | total_score, ability_scores, estimated_level |

---

## 🧪 MVP验收标准

### 功能完整性
- ✅ 用户可完成完整考试流程（配置→答题→提交→结果）
- ✅ 题目抽取符合策略（11易+7中+2难，18选择+2简答）
- ✅ 防作弊监控正常工作
- ✅ 选择题自动评分准确率100%
- ✅ 简答题可人工评阅

### 安全性
- ✅ 网络抓包验证无答案泄露
- ✅ 无法访问他人会话
- ✅ 管理员权限验证正常

### 性能
- ✅ 页面加载 < 2秒
- ✅ 答案保存 < 500ms
- ✅ 支持并发50人考试

---

## 📝 开发优先级

### P0（MVP必须）
- [x] 数据库Schema设计
- [ ] 题库录入（80题）
- [ ] 题目选择算法
- [ ] 答题引擎（倒计时+防作弊）
- [ ] 自动评分系统
- [ ] 结果报告页

### P1（MVP推荐）
- [ ] 心跳同步机制
- [ ] API限流
- [ ] 手工验证清单执行
- [ ] 移动端适配

### P2（V2功能，MVP不实现）
- [ ] LLM动态生成题目
- [ ] Google L级映射（L3-L7+）
- [ ] PDF报告导出
- [ ] 百分位排名展示
- [ ] 摄像头监控

---

## 🔄 版本历史

### v1.0 - MVP（当前）
- ✅ 静态题库（80题）
- ✅ 4维能力评估
- ✅ 职级映射（P5-P9）
- ✅ 防作弊监控
- ✅ 人工评阅简答题

### v2.0 - 计划中（暂不实现）
- 动态题库（LLM生成）
- Google L级支持（L3-L7+）
- PDF报告下载
- 百分位排名展示
- 高级防作弊（摄像头）
- 批量管理功能
- 更多语言/框架支持

---

## 📞 联系方式

**文档维护：** Product & Tech Team
**反馈渠道：** [GitHub Issues] 或内部工作群

---

## 📖 附录

### 推荐阅读顺序（新人入职）
1. README.md（本文件）
2. PRD-技术能力评估系统.md
3. API接口契约与安全规范.md
4. MVP任务拆解.md
5. 数据库Schema设计.md

### 外部资源
- [Next.js 15 文档](https://nextjs.org/docs)
- [Drizzle ORM 文档](https://orm.drizzle.team/)
- [Supabase Auth 文档](https://supabase.com/docs/guides/auth)
- [Recharts 文档](https://recharts.org/)

---

**祝开发顺利！🚀**
